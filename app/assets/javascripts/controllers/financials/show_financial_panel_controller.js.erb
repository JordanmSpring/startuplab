angular.module('StartupLab')
.controller('ShowFinancialPanelController', ['$scope', '$routeParams', 'FinancialEntry', function($scope, $routeParams, FinancialEntry) {
  $scope.newEntry = {};

  $scope.showModal = function() {
    $scope.modal.modal('show');
  };

  $scope.updateEntry = function(entry) {
    FinancialEntry.save($scope.idea, entry);
  }

  $scope.destroyEntry = function(entry) {
    if (confirm('Are you sure?')) {
      FinancialEntry.destroy($scope.idea, entry).then(function(resp) {
        var index = $scope.idea.financialEntries[entry.group].indexOf(entry);
        if (index > -1) {
          $scope.idea.financialEntries[entry.group].splice(index, 1);
        }
      });
    };
  }

  $scope.createEntry = function(group) {
    $scope.newEntry.group = group;
    FinancialEntry.create($scope.idea, $scope.newEntry).then(function(resp) {
      $scope.newEntry = {};
      if (!$scope.idea.financialEntries[group]) {
        $scope.idea.financialEntries[group] = [];
      }
      $scope.idea.financialEntries[group].push(resp.data);
      $scope.newEntryForm.$setPristine();
    });
  };
}]);
