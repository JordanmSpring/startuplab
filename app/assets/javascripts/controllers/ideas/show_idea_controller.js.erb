angular.module('StartupLab')
.controller('ShowIdeaController', ['$scope', '$routeParams', '$location', 'Idea', 'Session', 'user',
    function($scope, $routeParams, $location, Idea, Session, user) {

  $scope.session = Session;

  // TODO: Use a resolver in the routes
  Idea.find($routeParams.id).then(function(response) {
    $scope.idea = response.data;
  });

  /* Init isotope */
  $('.grid').isotope({
    itemSelector: '.grid-item',
    masonry: {
      // use outer width of grid-sizer for columnWidth
      columnWidth: 191
    },
    sortBy: 'original-order'
  });

  $scope.publish = function() {
    if (confirm('Are you ready to publish?')) {
      Idea.publish($scope.idea).then(function() {
        $scope.idea.published = true;
        alert('Published!');
      }, function() {
        alert('Could not publish');
      });
    }
  }

  $scope.delete = function() {
    if (confirm('Are you sure you want to delete?')) {
      Idea.delete($scope.idea).then(function() {
        $location.path('/dashboard');
      }, function() {
        alert('Could not delete');
      });
    }
  }

}]);
